{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"./firstTime.html","imported":[],"specifiers":[]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"imports/ui/pages/firstTime.js","filenameRelative":"imports/ui/pages/firstTime.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/ui/pages/firstTime.js.map","sourceFileName":"imports/ui/pages/firstTime.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"firstTime"},"ignored":false,"code":"module.watch(require(\"./firstTime.html\"));\nTemplate.firstTime.onRendered(function () {\n    Tracker.autorun(function () {\n        var courseSub = Meteor.subscribe('allCourses', 1000);\n        var clubSub = Meteor.subscribe('allClubs', 1000);\n\n        if (courseSub.ready() && clubSub.ready()) {\n            var courses = Courses.find({});\n            var clubs = Clubs.find({});\n            courses.observeChanges({\n                added: function (id, fields) {\n                    var newCat = new Option(fields.name + \" - \" + fields.code, fields.code);\n                    $('#firstCourseSelect').append(newCat);\n                }\n            });\n            clubs.observeChanges({\n                added: function (id, fields) {\n                    var newCat = new Option(fields.name, fields.code);\n                    $('#firstClubSelect').append(newCat);\n                }\n            });\n        }\n    });\n    $('#firstCourseSelect').select2({\n        placeholder: \"Click to select matching categories\",\n        allowClear: true\n    });\n    $('#firstClubSelect').select2({\n        placeholder: \"Click to select matching categories\",\n        allowClear: true\n    });\n});\nTemplate.firstTime.events({\n    'click #startFirst': function (evt, template) {\n        evt.preventDefault();\n        swapElements('#firstIntro', '#teachIntro');\n        swapElements('#beginIntro', '#teachAssistInfo');\n    },\n    'click #skipNext': function (evt, template) {\n        evt.preventDefault();\n        swapElements('#teachIntro', '#emailIntro');\n        swapElements('#teachAssistInfo', '#subscriptionEmail');\n    },\n    'click #skipEmail': function (evt, template) {\n        evt.preventDefault();\n        var user = Meteor.user();\n        $('#introName').val(user.services.google.name);\n        $('#introStudentNum').val(user.profile.student_number);\n        $('#introSubEmail').val(user.profile.email);\n        swapElements('#emailIntro', '#confirmIntro');\n        swapElements('#subscriptionEmail', '#confirmDetails');\n    },\n    'submit #teachAssistForm': function (evt) {\n        evt.preventDefault();\n        var user = $('#teachUser').val();\n        var pass = $('#teachPass').val();\n        $('.teach-assist-login').fadeOut('fast', function () {\n            $('.teachLoader').fadeIn('slow');\n        });\n        Meteor.call('getTeachAssistTokens', {\n            student_number: user,\n            password: pass\n        }, function (err, data) {\n            if (err) {\n                alertError(\"Failed to connect with teach assist\", err.message);\n                $('.teachLoader').fadeOut('fast', function () {\n                    $('.teach-assist-login').fadeIn('slow');\n                });\n            } else {\n                Meteor.users.update({\n                    _id: Meteor.userId()\n                }, {\n                    $set: {\n                        \"private.token\": data,\n                        \"private.tokenDate\": new Date()\n                    }\n                }, function (err) {\n                    if (err) {\n                        alertError(\"Something went wrong\", \"You can connect your account anytime later\");\n                        swapElements('#teachIntro', '#emailIntro');\n                        swapElements('#teachAssistInfo', '#subscriptionEmail');\n                    } else {\n                        Meteor.users.update({\n                            _id: Meteor.userId()\n                        }, {\n                            $set: {\n                                \"profile.student_number\": user\n                            }\n                        });\n                        Meteor.call('getTeachAssistCourses', data, function (err, data) {\n                            if (err) {\n                                alertError(\"Something went wrong\", \"You can connect your account anytime later\");\n                                swapElements('#teachIntro', '#emailIntro');\n                                swapElements('#teachAssistInfo', '#subscriptionEmail');\n                            } else {\n                                Meteor.users.update({\n                                    _id: Meteor.userId()\n                                }, {\n                                    $set: {\n                                        \"private.courses\": data\n                                    }\n                                });\n                                alertSuccess(\"Yeah!\", 'We have successfully connected you and teach assist, however further login will be required since token may expire.');\n                                swapElements('#teachIntro', '#emailIntro');\n                                swapElements('#teachAssistInfo', '#subscriptionEmail');\n                            }\n                        });\n                    }\n                });\n            }\n        });\n    },\n    'submit #organizationsForm': function (evt) {\n        evt.preventDefault();\n        var courses = $('#firstCourseSelect').val();\n        var clubs = $('#firstClubSelect').val();\n        Meteor.users.update({\n            _id: Meteor.userId()\n        }, {\n            $set: {\n                \"profile.courses\": courses,\n                \"profile.clubs\": clubs\n            }\n        }, function (err) {\n            if (err) {\n                alertError(\"Error Occurred when updating your profile\", err.message);\n            } else {\n                alertSuccess(\"Thank you!\", \"We have recorded the information you provided\");\n            }\n        });\n    },\n    'submit #newsletterEmailForm': function (evt) {\n        evt.preventDefault();\n        var email = $('#personalEmail').val();\n        var userInfo = Meteor.user().services.google;\n\n        if (!validateEmail(email)) {\n            alertError(\"Sorry...\", \"The email you entered is unacceptable.\");\n        } else {\n            Meteor.call('news.addSubscriber', email, userInfo.given_name, userInfo.family_name, function (err) {\n                if (err) {\n                    alertError(\"Something went wrong\", err.message + \"\\nYou can subscribe to the newsletter anytime later.\");\n                } else {\n                    Session.set('personalEmail', email);\n                    alertSuccess(\"Great!\", \"We have signed you up for newsletters!\");\n                    swapElements('#emailIntro', '#confirmIntro');\n                    swapElements('#subscriptionEmail', '#confirmDetails');\n                }\n            });\n        }\n    },\n    'submit #finalForm': function (evt, template) {\n        evt.preventDefault();\n\n        if (document.getElementById('checkboxTerms').checked) {\n            var id = Meteor.userId();\n            Meteor.call('initUserProfile', id, function (err) {\n                if (err) {\n                    alertError('Error Initiating Your Account', err.message);\n                } else {\n                    swapElements('.wizard-container', '.final-message');\n                    setTimeout(function () {\n                        FlowRouter.go('/');\n                    }, 3000);\n                }\n            });\n        } else {\n            alertError(\"Oops.\", \"Please agree to the terms of service.\");\n        }\n    }\n});\n\nfunction swapElements(a, b) {\n    $(a).fadeOut('fast', function () {\n        $(this).replaceWith($(b));\n        $(b).fadeIn(\"slow\");\n    });\n}\n\nfunction validateEmail(email) {\n    var re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email);\n}","map":{"version":3,"sources":["imports/ui/pages/firstTime.js"],"names":["module","watch","require","Template","firstTime","onRendered","Tracker","autorun","courseSub","Meteor","subscribe","clubSub","ready","courses","Courses","find","clubs","Clubs","observeChanges","added","id","fields","newCat","Option","name","code","$","append","select2","placeholder","allowClear","events","evt","template","preventDefault","swapElements","user","val","services","google","profile","student_number","email","pass","fadeOut","fadeIn","call","password","err","data","alertError","message","users","update","_id","userId","$set","Date","alertSuccess","userInfo","validateEmail","given_name","family_name","Session","set","document","getElementById","checked","setTimeout","FlowRouter","go","a","b","replaceWith","re","test"],"mappings":"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","file":"imports/ui/pages/firstTime.js.map","sourcesContent":["/**\r\n * Created by Yonglin Wang on 8/3/2017.\r\n */\r\nimport './firstTime.html'\r\n\r\nTemplate.firstTime.onRendered(function () {\r\n    Tracker.autorun(function () {\r\n        let courseSub = Meteor.subscribe('allCourses',1000);\r\n        let clubSub = Meteor.subscribe('allClubs',1000);\r\n        if(courseSub.ready() && clubSub.ready()){\r\n            let courses = Courses.find({});\r\n            let clubs = Clubs.find({});\r\n            courses.observeChanges({\r\n                added: function (id, fields) {\r\n                    let newCat = new Option(fields.name + \" - \" + fields.code, fields.code);\r\n                    $('#firstCourseSelect').append(newCat)\r\n                }\r\n            });\r\n            clubs.observeChanges({\r\n                added: function (id, fields) {\r\n                    let newCat = new Option(fields.name, fields.code);\r\n                    $('#firstClubSelect').append(newCat)\r\n                }\r\n            })\r\n        }\r\n    });\r\n    $('#firstCourseSelect').select2({\r\n        placeholder: \"Click to select matching categories\",\r\n        allowClear: true\r\n    });\r\n    $('#firstClubSelect').select2({\r\n        placeholder: \"Click to select matching categories\",\r\n        allowClear: true\r\n    });\r\n});\r\n\r\nTemplate.firstTime.events({\r\n    'click #startFirst': function (evt,template) {\r\n        evt.preventDefault();\r\n        swapElements('#firstIntro','#teachIntro');\r\n        swapElements('#beginIntro','#teachAssistInfo');\r\n    },\r\n    'click #skipNext': function (evt,template) {\r\n        evt.preventDefault();\r\n        swapElements('#teachIntro', '#emailIntro');\r\n        swapElements('#teachAssistInfo', '#subscriptionEmail');\r\n    },\r\n    'click #skipEmail': function (evt,template) {\r\n        evt.preventDefault();\r\n        const user = Meteor.user();\r\n        $('#introName').val(user.services.google.name);\r\n        $('#introStudentNum').val(user.profile.student_number);\r\n        $('#introSubEmail').val(user.profile.email);\r\n        swapElements('#emailIntro', '#confirmIntro');\r\n        swapElements('#subscriptionEmail', '#confirmDetails');\r\n    },\r\n    'submit #teachAssistForm': function (evt) {\r\n        evt.preventDefault();\r\n        const user = $('#teachUser').val();\r\n        const pass = $('#teachPass').val();\r\n        $('.teach-assist-login').fadeOut('fast', function () {\r\n           $('.teachLoader').fadeIn('slow')\r\n        });\r\n        Meteor.call('getTeachAssistTokens', {student_number: user, password: pass}, function (err, data) {\r\n            if(err){\r\n                alertError(\"Failed to connect with teach assist\", err.message);\r\n                $('.teachLoader').fadeOut('fast', function () {\r\n                    $('.teach-assist-login').fadeIn('slow')\r\n                });\r\n            }else{\r\n                Meteor.users.update({_id: Meteor.userId()}, {$set: {\"private.token\": data, \"private.tokenDate\": new Date()}}, function (err) {\r\n                    if(err){\r\n                        alertError(\"Something went wrong\", \"You can connect your account anytime later\");\r\n                        swapElements('#teachIntro', '#emailIntro');\r\n                        swapElements('#teachAssistInfo', '#subscriptionEmail');\r\n                    }else{\r\n                        Meteor.users.update({_id: Meteor.userId()}, {$set: {\"profile.student_number\": user}});\r\n                        Meteor.call('getTeachAssistCourses', data, function (err,data) {\r\n                            if(err){\r\n                                alertError(\"Something went wrong\", \"You can connect your account anytime later\");\r\n                                swapElements('#teachIntro', '#emailIntro');\r\n                                swapElements('#teachAssistInfo', '#subscriptionEmail');\r\n                            }else{\r\n                                Meteor.users.update({_id: Meteor.userId()}, {$set: {\"private.courses\": data}});\r\n                                alertSuccess(\"Yeah!\", 'We have successfully connected you and teach assist, however further login will be required since token may expire.');\r\n                                swapElements('#teachIntro', '#emailIntro');\r\n                                swapElements('#teachAssistInfo', '#subscriptionEmail');\r\n                            }\r\n                        })\r\n                    }\r\n                });\r\n            }\r\n        })\r\n    },\r\n    'submit #organizationsForm': function (evt) {\r\n        evt.preventDefault();\r\n        const courses = $('#firstCourseSelect').val();\r\n        const clubs = $('#firstClubSelect').val();\r\n        Meteor.users.update({_id: Meteor.userId()}, {$set: {\"profile.courses\": courses, \"profile.clubs\": clubs}}, function (err) {\r\n            if(err){\r\n                alertError(\"Error Occurred when updating your profile\", err.message)\r\n            }else {\r\n                alertSuccess(\"Thank you!\", \"We have recorded the information you provided\")\r\n            }\r\n        });\r\n    },\r\n    'submit #newsletterEmailForm': function (evt) {\r\n        evt.preventDefault();\r\n        let email = $('#personalEmail').val();\r\n        let userInfo = Meteor.user().services.google;\r\n        if(!validateEmail(email)){\r\n            alertError(\"Sorry...\", \"The email you entered is unacceptable.\")\r\n        }else{\r\n            Meteor.call('news.addSubscriber', email, userInfo.given_name, userInfo.family_name, function (err) {\r\n                if(err){\r\n                    alertError(\"Something went wrong\", err.message + \"\\nYou can subscribe to the newsletter anytime later.\")\r\n                }else{\r\n                    Session.set('personalEmail', email);\r\n                    alertSuccess(\"Great!\", \"We have signed you up for newsletters!\");\r\n                    swapElements('#emailIntro', '#confirmIntro');\r\n                    swapElements('#subscriptionEmail', '#confirmDetails');\r\n                }\r\n            })\r\n        }\r\n    },\r\n    'submit #finalForm': function (evt,template) {\r\n        evt.preventDefault();\r\n        if(document.getElementById('checkboxTerms').checked){\r\n            let id = Meteor.userId();\r\n            Meteor.call('initUserProfile', id, function (err) {\r\n                if(err){\r\n                    alertError('Error Initiating Your Account', err.message);\r\n                }else{\r\n                    swapElements('.wizard-container', '.final-message');\r\n                    setTimeout(function () {\r\n                        FlowRouter.go('/')\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }else{\r\n            alertError(\"Oops.\", \"Please agree to the terms of service.\")\r\n        }\r\n\r\n    }\r\n});\r\n\r\nfunction swapElements(a,b){\r\n    $(a).fadeOut('fast', function () {\r\n        $(this).replaceWith($(b));\r\n        $(b).fadeIn(\"slow\");\r\n    });\r\n}\r\nfunction validateEmail(email) {\r\n    var re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n    return re.test(email);\r\n}"]},"hash":"6e214f0733be27739d4c65b036c64a4e9b2ddf20"}
